[
  {
    "doctype": "Client Script",
    "dt": "Employee",
    "enabled": 1,
    "modified": "2025-04-23 12:55:46",
    "module": "Payroll Indonesia",
    "name": "Employee-Form",
    "script": "frappe.ui.form.on('Employee', {\n    status_pajak: function(frm) {\n        if (frm.doc.status_pajak) {\n            // Extract number from status pajak (e.g., K2 -> 2, TK3 -> 3, HB1 -> 1)\n            let tanggungan = 0;\n            \n            if (frm.doc.status_pajak.startsWith('TK')) {\n                tanggungan = parseInt(frm.doc.status_pajak.substring(2), 10) || 0;\n            } else if (frm.doc.status_pajak.startsWith('K') && frm.doc.status_pajak.length === 2) {\n                tanggungan = parseInt(frm.doc.status_pajak.substring(1), 10) || 0;\n            } else if (frm.doc.status_pajak.startsWith('HB')) {\n                tanggungan = parseInt(frm.doc.status_pajak.substring(2), 10) || 0;\n            }\n            \n            frm.set_value('jumlah_tanggungan', tanggungan);\n        } else {\n            frm.set_value('jumlah_tanggungan', 0);\n        }\n    },\n    \n    npwp_gabung_suami: function(frm) {\n        if (frm.doc.npwp_gabung_suami) {\n            frappe.msgprint('Penghasilan PPh 21 akan digabung dengan NPWP suami');\n            frm.set_value('penghasilan_final', 1);\n        } else {\n            frm.set_value('penghasilan_final', 0);\n        }\n    },\n    \n    gender: function(frm) {\n        // Reset NPWP suami related fields if gender is changed to male\n        if (frm.doc.gender === 'Male') {\n            frm.set_value('npwp_suami', '');\n            frm.set_value('npwp_gabung_suami', 0);\n        }\n    },\n    \n    validate: function(frm) {\n        // Validate NPWP format if provided\n        if (frm.doc.npwp && frm.doc.npwp.length > 0) {\n            let npwpPattern = /^\\d{2}\\.\\d{3}\\.\\d{3}\\.(\\d|X)-\\d{3}\\.\\d{3}$/;\n            if (!npwpPattern.test(frm.doc.npwp)) {\n                frappe.msgprint('Format NPWP tidak valid. Gunakan format: XX.XXX.XXX.X-XXX.XXX');\n                frappe.validated = false;\n            }\n        }\n        \n        // Validate NPWP Suami format if provided\n        if (frm.doc.npwp_suami && frm.doc.npwp_suami.length > 0) {\n            let npwpPattern = /^\\d{2}\\.\\d{3}\\.\\d{3}\\.(\\d|X)-\\d{3}\\.\\d{3}$/;\n            if (!npwpPattern.test(frm.doc.npwp_suami)) {\n                frappe.msgprint('Format NPWP Suami tidak valid. Gunakan format: XX.XXX.XXX.X-XXX.XXX');\n                frappe.validated = false;\n            }\n        }\n    }\n});",
    "view": "Form"
  }
]